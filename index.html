<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Plot Twisted</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Special+Elite&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
/* ============================================
   PLOT TWISTED V2 - RETRO CINEMA AESTHETIC
   ============================================ */

:root {
    --bg-deep: #0a0a0f;
    --bg-dark: #12121a;
    --bg-card: #1a1a24;
    --bg-elevated: #242430;
    --gold-primary: #d4a853;
    --gold-light: #f0d078;
    --gold-dark: #a67c32;
    --gold-glow: rgba(212, 168, 83, 0.4);
    --red-primary: #c41e3a;
    --red-light: #e63950;
    --red-glow: rgba(196, 30, 58, 0.5);
    --cream: #f5f0e6;
    --cream-muted: #c9c4b8;
    --text-muted: #6b6b7b;
    --font-display: 'Playfair Display', serif;
    --font-title: 'Bebas Neue', sans-serif;
    --font-body: 'Inter', sans-serif;
    --font-typewriter: 'Special Elite', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; }

html, body {
    height: 100%;
    font-family: var(--font-body);
    background: var(--bg-deep);
    color: var(--cream);
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
}

.film-grain {
    position: fixed; inset: 0; pointer-events: none; z-index: 9999; opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

.screen { display: none; position: fixed; inset: 0; flex-direction: column; opacity: 0; transition: opacity 0.4s ease; }
.screen.active { display: flex; opacity: 1; }

/* START SCREEN */
#startScreen {
    background: radial-gradient(ellipse at 50% 0%, rgba(212, 168, 83, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 100%, rgba(196, 30, 58, 0.1) 0%, transparent 40%), var(--bg-deep);
    justify-content: center; align-items: center; padding: 20px;
}

.marquee-frame { position: relative; padding: 40px 30px; max-width: 400px; width: 100%; }
.marquee-frame::before, .marquee-frame::after { content: ''; position: absolute; width: 60px; height: 60px; border: 3px solid var(--gold-primary); opacity: 0.6; }
.marquee-frame::before { top: 0; left: 0; border-right: none; border-bottom: none; }
.marquee-frame::after { bottom: 0; right: 0; border-left: none; border-top: none; }

.main-title { text-align: center; margin-bottom: 15px; }
.title-plot { font-family: var(--font-display); font-size: clamp(3.5rem, 12vw, 5rem); font-weight: 900; color: var(--cream); letter-spacing: 0.02em; line-height: 0.9; text-shadow: 0 2px 0 var(--gold-dark), 0 0 40px var(--gold-glow); }
.title-twisted { font-family: var(--font-title); font-size: clamp(2rem, 8vw, 3rem); color: var(--red-primary); letter-spacing: 0.3em; margin-top: -5px; }
.tagline { font-family: var(--font-typewriter); font-size: 1rem; color: var(--cream-muted); text-align: center; margin-bottom: 30px; }

.btn { font-family: var(--font-body); font-weight: 600; border: none; cursor: pointer; transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.1em; border-radius: 4px; }
.btn:disabled { opacity: 0.5; cursor: wait; }

.btn-play-daily {
    display: flex; align-items: center; justify-content: center; gap: 12px;
    width: 100%; padding: 20px 30px; font-size: 1.2rem;
    background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold-primary) 50%, var(--gold-dark) 100%);
    color: var(--bg-deep); box-shadow: 0 4px 15px var(--gold-glow); margin-bottom: 12px; font-weight: 900;
}

.btn-row { display: flex; gap: 12px; margin-bottom: 12px; width: 100%; }
.btn-row .btn { flex: 1; padding: 16px 10px; font-size: 0.85rem; }
.btn-arcade { background: var(--bg-elevated); color: var(--gold-light); border: 1px solid var(--gold-dark); }
.btn-pass { background: var(--bg-elevated); color: var(--cream); border: 1px solid var(--text-muted); }
.btn-secondary-flat { background: transparent; color: var(--text-muted); }

.btn-premium {
    background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold-primary) 50%, var(--gold-dark) 100%);
    color: var(--bg-deep); border: 1px solid var(--cream); box-shadow: 0 4px 15px var(--gold-glow);
    font-weight: 800; position: relative; overflow: hidden;
}

.stats-bar { display: flex; justify-content: center; align-items: center; margin-top: 40px; border-top: 1px solid rgba(212, 168, 83, 0.2); min-height: 80px; }
.movie-quote { font-family: var(--font-typewriter); font-size: 0.95rem; color: var(--cream-muted); text-align: center; font-style: italic; }

/* CATEGORY SCREEN */
#categoryScreen { background: var(--bg-deep); padding: 20px; overflow-y: auto; }
.category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 500px; margin: 0 auto 100px; }
.category-card { background: var(--bg-card); border: 2px solid var(--bg-elevated); border-radius: 12px; padding: 25px 15px; text-align: center; cursor: pointer; }
.category-card.selected { border-color: var(--gold-primary); box-shadow: 0 0 20px var(--gold-glow); }

/* GAME SCREEN */
.game-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--bg-dark); border-bottom: 1px solid rgba(212, 168, 83, 0.2); }
.game-logo { font-family: var(--font-display); font-size: 1.2rem; color: var(--gold-primary); }
.game-mode-tag { font-family: var(--font-title); font-size: 0.7rem; color: var(--red-light); border: 1px solid var(--red-primary); padding: 2px 6px; border-radius: 2px; display: none; }
.strikes-display { display: flex; gap: 4px; }
.strike-pip { width: 10px; height: 10px; border-radius: 50%; background: var(--red-primary); box-shadow: 0 0 8px var(--red-glow); }
.strike-pip.used { background: var(--bg-elevated); box-shadow: none; }

.clue-card { width: 100%; max-width: 500px; background: var(--bg-card); border: 1px solid rgba(212, 168, 83, 0.3); border-radius: 8px; padding: 30px 25px; position: relative; }
.clue-text { font-family: var(--font-typewriter); font-size: 1.3rem; line-height: 1.7; text-align: center; }

/* RESULTS BREAKDOWN */
.final-breakdown { background: var(--bg-card); border-radius: 8px; padding: 20px; margin-bottom: 30px; border: 1px solid rgba(212, 168, 83, 0.2); max-height: 220px; overflow-y: auto; }
.final-breakdown::-webkit-scrollbar { width: 6px; }
.final-breakdown::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 10px; }

.marquee-screen { background: var(--bg-deep); padding: 20px; overflow-y: auto; }
.cinema-section { background: var(--bg-card); border: 1px solid rgba(212, 168, 83, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px; }

/* DAILY LOCK SCREEN */
#dailyCompleteScreen { background: var(--bg-deep); justify-content: center; align-items: center; padding: 20px; text-align: center; position: fixed; inset: 0; z-index: 100; }
.daily-lock-box { max-width: 400px; padding: 40px; background: var(--bg-dark); border: 1px solid var(--gold-dark); border-radius: 8px; }

.toggle { width: 50px; height: 28px; background: var(--bg-elevated); border-radius: 14px; position: relative; cursor: pointer; }
.toggle.active { background: var(--gold-primary); }
.toggle::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: var(--cream); border-radius: 50%; transition: 0.2s; }
.toggle.active::after { transform: translateX(22px); }

.shake { animation: shake 0.4s ease; }
@keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-8px); } 40%, 80% { transform: translateX(8px); } }
    </style>
</head>
<body>
    <div class="film-grain"></div>

    <div id="startScreen" class="screen active">
        <div class="marquee-frame">
            <div class="main-title"><div class="title-plot">PLOT</div><div class="title-twisted">TWISTED</div></div>
            <p class="tagline">Guess the movie from the twisted summary</p>
            <div class="divider"><span class="divider-line"></span><span class="divider-star">â˜…</span><span class="divider-line"></span></div>
            <button class="btn btn-play-daily" id="dailyBtn" disabled>Daily Challenge</button>
            <div class="btn-row">
                <button class="btn btn-arcade" id="arcadeBtn" disabled>Arcade Mode</button>
                <button class="btn btn-pass" id="passBtn" disabled>Pass and Play</button>
            </div>
            <div class="btn-row">
                <button class="btn btn-secondary-flat" id="howToPlayBtn">How to Play</button>
                <button class="btn btn-secondary-flat" id="settingsBtn">Settings</button>
            </div>
            <div class="stats-bar"><p class="movie-quote">"Snakes, I hate snakes"</p></div>
        </div>
    </div>

    <div id="dailyCompleteScreen" class="screen">
        <div class="daily-lock-box">
            <h2 style="font-family: var(--font-display); color: var(--gold-light); margin-bottom: 20px;">Theater Closed</h2>
            <p class="tagline" style="font-family: var(--font-typewriter); color: var(--cream-muted); margin-bottom: 30px;">The curtain has closed for today's premiere. The next showing begins at midnight. Keep your streak alive!</p>
            <button class="btn btn-premium" id="dailyShareBtn" style="padding: 16px 24px; width: 100%;">Share My Score</button>
            <button class="btn btn-outline-gold" id="dailyMenuBtn" style="padding: 12px 24px; width: 100%; margin-top:12px;">Main Menu</button>
        </div>
    </div>

    <div id="categoryScreen" class="screen">
        <div class="marquee-screen-content" style="max-width:500px; margin: 0 auto; text-align:center;">
            <h2 style="font-family: var(--font-display); margin: 30px 0 10px;">Choose Your Genre</h2>
            <div class="category-grid" id="categoryGrid"></div>
            <div class="category-actions"><button class="btn btn-back" id="categoryBackBtn">Back</button><button class="btn btn-start" id="startGameBtn" disabled>Start</button></div>
        </div>
    </div>

    <div id="howToPlayScreen" class="screen marquee-screen">
        <div class="marquee-screen-content" style="max-width:500px; margin: 0 auto;">
            <h2 style="font-family: var(--font-display); margin-bottom:20px;">Production Notes</h2>
            <div class="cinema-section"><h3>ðŸŽ¬ THE SCRIPT</h3><p>Read the twisted summary. Identify the title before the pot runs dry.</p></div>
            <div class="cinema-section"><h3>ðŸ’° BOX OFFICE</h3><p>Start with 500 points. Hints cost 50 points each.</p></div>
            <button class="btn btn-outline-gold" id="howToBackBtn" style="width:100%; padding: 15px;">Back</button>
        </div>
    </div>

    <div id="settingsScreen" class="screen marquee-screen">
        <div class="marquee-screen-content" style="max-width:500px; margin: 0 auto;">
            <h2 style="font-family: var(--font-display); margin-bottom:20px;">Director's Cut</h2>
            <div class="cinema-section">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span>FX SOUNDS</span><div class="toggle" id="soundToggle"></div>
                </div>
            </div>
            <button class="btn btn-outline-gold" id="settingsBackBtn" style="width:100%; padding: 15px;">Back</button>
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div class="game-header">
            <div class="game-logo">Plot Twisted <span class="game-mode-tag" id="modeTag">DAILY</span></div>
            <div class="game-stats">
                <div class="game-stat"><div class="game-stat-value points" id="totalScore">0</div></div>
                <div class="strikes-display" id="strikesDisplay"><div class="strike-pip"></div><div class="strike-pip"></div><div class="strike-pip"></div></div>
            </div>
            <button class="btn btn-quit" id="quitBtn">âœ•</button>
        </div>
        <div class="game-content">
            <div class="progress-track" id="progressTrack"></div>
            <div class="clue-card" id="clueCard"><div class="clue-text" id="clueText"></div></div>
            <div style="font-family: var(--font-display); font-size: 1.5rem; color: var(--gold-light);" id="potValue">500</div>
            <div class="title-reveal" id="titleLetters" style="display:flex; flex-wrap:wrap; justify-content:center; gap:8px; font-family: var(--font-title); font-size: 2rem;"></div>
            <div class="action-buttons" style="display:flex; gap:10px; width:100%; max-width:500px;">
                <button class="btn btn-arcade" id="revealBtn" style="flex:1; padding:15px;">Hint</button>
                <button class="btn btn-premium" id="solveBtn" style="flex:2; padding:15px;">Solve</button>
            </div>
        </div>
    </div>

    <div id="gameOverScreen" class="screen">
        <div class="game-over-card" style="text-align:center; padding: 20px;">
            <div class="roll-credits">Roll the Credits!</div>
            <div class="final-score" id="finalScore" style="font-size: 4rem; color: var(--gold-light);">0</div>
            <div class="final-breakdown" id="finalBreakdown"></div>
            <button class="btn btn-premium" id="shareScoreBtn" style="width:100%; padding:18px; margin-bottom:10px;">Share Score</button>
            <button class="btn btn-arcade" id="playAgainBtn" style="width:100%; padding:15px; margin-bottom:10px;">Play Again</button>
            <button class="btn btn-secondary-flat" id="menuBtn" style="width:100%; padding:15px;">Main Menu</button>
        </div>
    </div>

    <div class="modal-overlay" id="solveModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:200; justify-content:center; align-items:center;">
        <div style="background:var(--bg-card); padding:30px; border-radius:8px; width:90%; max-width:400px; text-align:center;">
            <h3 style="margin-bottom:20px;">Answer?</h3>
            <input type="text" id="solveInput" style="width:100%; padding:15px; background:#000; color:#fff; border:1px solid var(--gold-dark); margin-bottom:20px;">
            <div style="display:flex; gap:10px;"><button class="btn btn-arcade" id="cancelSolveBtn" style="flex:1; padding:10px;">Cancel</button><button class="btn btn-premium" id="submitSolveBtn" style="flex:1; padding:10px;">Submit</button></div>
        </div>
    </div>

<script>
class PlotTwisted {
    constructor() {
        this.state = { currentScreen: 'start', questions: [], currentIndex: 0, totalScore: 0, strikes: 3, currentPot: 500, revealedIndices: [], results: [], seenClues: {}, mode: 'arcade' };
        this.clueBank = null;
    }

    async init() {
        this.cacheDOM();
        this.bindEvents();
        this.loadSettings();
        await this.loadClueDatabase();
    }

    async loadClueDatabase() {
        try {
            const response = await fetch('./clues.json');
            this.clueBank = await response.json();
            document.querySelectorAll('button').forEach(b => b.disabled = false);
        } catch (err) {
            console.error("Clues failed to load. Check if clues.json exists in the same folder.", err);
        }
    }

    cacheDOM() {
        this.screens = { start: document.getElementById('startScreen'), category: document.getElementById('categoryScreen'), howToPlay: document.getElementById('howToPlayScreen'), settings: document.getElementById('settingsScreen'), game: document.getElementById('gameScreen'), gameOver: document.getElementById('gameOverScreen'), dailyComplete: document.getElementById('dailyCompleteScreen') };
        this.dom = { 
            grid: document.getElementById('categoryGrid'), startBtn: document.getElementById('startGameBtn'),
            clue: document.getElementById('clueText'), pot: document.getElementById('potValue'), score: document.getElementById('totalScore'),
            letters: document.getElementById('titleLetters'), input: document.getElementById('solveInput'), 
            breakdown: document.getElementById('finalBreakdown'), modal: document.getElementById('solveModal')
        };
    }

    bindEvents() {
        document.getElementById('dailyBtn').onclick = () => this.handleDailyChallengeNav();
        document.getElementById('arcadeBtn').onclick = () => this.showScreen('category');
        document.getElementById('howToPlayBtn').onclick = () => this.showScreen('howToPlay');
        document.getElementById('settingsBtn').onclick = () => this.showScreen('settings');
        document.getElementById('howToBackBtn').onclick = () => this.showScreen('start');
        document.getElementById('settingsBackBtn').onclick = () => this.showScreen('start');
        document.getElementById('dailyMenuBtn').onclick = () => this.showScreen('start');
        document.getElementById('dailyShareBtn').onclick = () => this.shareScore();
        document.getElementById('shareScoreBtn').onclick = () => this.shareScore();
        document.getElementById('quitBtn').onclick = () => this.showScreen('start');
        document.getElementById('categoryBackBtn').onclick = () => this.showScreen('start');
        this.dom.startBtn.onclick = () => this.startGame();
        document.getElementById('revealBtn').onclick = () => this.revealLetter();
        document.getElementById('solveBtn').onclick = () => { this.dom.modal.style.display='flex'; this.dom.input.value=''; this.dom.input.focus(); };
        document.getElementById('cancelSolveBtn').onclick = () => this.dom.modal.style.display='none';
        document.getElementById('submitSolveBtn').onclick = () => this.submitSolve();
        document.getElementById('playAgainBtn').onclick = () => this.playAgain();
        document.getElementById('menuBtn').onclick = () => this.showScreen('start');
        document.getElementById('soundToggle').onclick = (e) => e.target.classList.toggle('active');
    }

    showScreen(name) {
        Object.values(this.screens).forEach(s => s.classList.remove('active'));
        this.screens[name].classList.add('active');
        if (name === 'category') this.renderCategories();
    }

    renderCategories() {
        this.dom.grid.innerHTML = '';
        Object.keys(this.clueBank).forEach(cat => {
            const card = document.createElement('div');
            card.className = 'category-card';
            card.innerHTML = `<div style="font-size:2rem;">ðŸŽ¬</div><div>${cat}</div>`;
            card.onclick = () => {
                document.querySelectorAll('.category-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                this.state.selectedCategory = cat;
                this.dom.startBtn.disabled = false;
            };
            this.dom.grid.appendChild(card);
        });
    }

    handleDailyChallengeNav() {
        const today = new Date().toISOString().split('T')[0];
        if (localStorage.getItem('plotTwistedDailyDone') === today) this.showScreen('dailyComplete');
        else this.startDaily();
    }

    startDaily() {
        this.state.mode = 'daily';
        document.getElementById('modeTag').style.display = 'inline-block';
        const all = [];
        Object.keys(this.clueBank).forEach(c => this.clueBank[c].forEach(q => all.push({...q, cat: c})));
        const seed = new Date().toISOString().split('T')[0].replace(/-/g,'');
        this.state.questions = this.seededShuffle(all, seed).slice(0,5);
        this.resetGame();
    }

    startGame() {
        this.state.mode = 'arcade';
        document.getElementById('modeTag').style.display = 'none';
        this.state.questions = this.clueBank[this.state.selectedCategory].sort(()=>0.5-Math.random()).slice(0,5);
        this.resetGame();
    }

    resetGame() {
        this.state.currentIndex = 0; this.state.totalScore = 0; this.state.strikes = 3; this.state.results = [];
        this.loadQuestion(); this.showScreen('game');
    }

    loadQuestion() {
        const q = this.state.questions[this.state.currentIndex];
        this.state.currentPot = 500; this.state.revealedIndices = [];
        this.dom.clue.textContent = q.clue;
        this.dom.pot.textContent = 500;
        this.renderTitle();
    }

    renderTitle() {
        const title = this.state.questions[this.currentIndex].title.toUpperCase();
        this.dom.letters.innerHTML = '';
        title.split('').forEach((char, i) => {
            const span = document.createElement('span');
            if (char === ' ') span.style.width = '20px';
            else span.textContent = this.state.revealedIndices.includes(i) || !/[A-Z0-9]/.test(char) ? char : '_';
            this.dom.letters.appendChild(span);
        });
    }

    revealLetter() {
        const title = this.state.questions[this.currentIndex].title.toUpperCase();
        const hidden = [];
        title.split('').forEach((c, i) => { if(/[A-Z0-9]/.test(c) && !this.state.revealedIndices.includes(i)) hidden.push(i); });
        if (hidden.length > 0) {
            this.state.revealedIndices.push(hidden[Math.floor(Math.random()*hidden.length)]);
            this.state.currentPot = Math.max(50, this.state.currentPot - 50);
            this.dom.pot.textContent = this.state.currentPot;
            this.renderTitle();
        }
    }

    submitSolve() {
        const guess = this.dom.input.value.trim().toLowerCase();
        const actual = this.state.questions[this.state.currentIndex].title.toLowerCase();
        this.dom.modal.style.display = 'none';
        if (guess === actual || actual.replace(/^the\s/,'') === guess) {
            this.state.totalScore += this.state.currentPot;
            this.state.results.push({title: this.state.questions[this.currentIndex].title, correct: true, points: this.state.currentPot});
            confetti({particleCount:100, spread:70, origin:{y:0.6}});
            this.next();
        } else {
            this.state.strikes--;
            this.updateStrikes();
            if (this.state.strikes <= 0) this.endGame();
        }
    }

    updateStrikes() {
        const pips = document.querySelectorAll('.strike-pip');
        pips.forEach((p, i) => p.classList.toggle('used', i >= this.state.strikes));
    }

    next() {
        this.state.currentIndex++;
        if (this.state.currentIndex >= 5) this.endGame();
        else this.loadQuestion();
    }

    endGame() {
        if (this.state.mode === 'daily') localStorage.setItem('plotTwistedDailyDone', new Date().toISOString().split('T')[0]);
        document.getElementById('finalScore').textContent = this.state.totalScore;
        this.dom.breakdown.innerHTML = '';
        this.state.results.forEach(r => {
            const div = document.createElement('div');
            div.style.display='flex'; div.style.justifyContent='space-between'; div.style.padding='10px 0';
            div.innerHTML = `<span>${r.title}</span><span style="color:var(--gold-primary)">+${r.points}</span>`;
            this.dom.breakdown.appendChild(div);
        });
        this.showScreen('gameOver');
    }

    shareScore() {
        const text = `ðŸŽ¬ Plot Twisted Daily\nðŸ† Score: ${this.state.totalScore}\nðŸŸ©ðŸŸ©ðŸŸ©ðŸŸ©ðŸŸ©`;
        navigator.clipboard.writeText(text);
        alert("Score copied to clipboard!");
    }

    playAgain() {
        if (this.state.mode === 'daily') this.handleDailyChallengeNav();
        else this.showScreen('category');
    }

    seededShuffle(arr, seed) {
        let m = arr.length, t, i;
        while (m) { i = Math.floor(Math.abs(Math.sin(seed++)) * m--); t = arr[m]; arr[m] = arr[i]; arr[i] = t; }
        return arr;
    }

    loadSettings() {}
}
document.addEventListener('DOMContentLoaded', () => { new PlotTwisted().init(); });
</script>
</body>
</html>
